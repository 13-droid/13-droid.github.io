<!-- Find all links tagged with #rss and create an rss feed -->
<!-- If current page has ?feed, go to feed -->

<a id='autoGeneratedReader' target='_blank'>Auto-Generated RSS Reader Link</a>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Base URL for the RSS reader
    const baseUrl = 'https://rss-reader.dutl.uk/';

    // Select all links on the page
    const links = document.querySelectorAll('a');

    // Filter links ending with #rss
    const rssLinks = Array.from(links)
      .map(link => link.href)
      .filter(href => href.endsWith('#rss'));

    // Encode the links and join them with commas
    const encodedLinks = rssLinks.map(encodeURIComponent).join(',');

    // Extract query params from the current page
    const currentQueryParams = new URLSearchParams(window.location.search);
    console.log(window.location)
    console.log(window.location.search)
    console.log("cqp", currentQueryParams)
    console.log("cqp.s", currentQueryParams.toString())

    // Add the feeds and ttl as new query params to the base URL
    currentQueryParams.set('feeds', encodedLinks);
    console.log("cqp2", currentQueryParams)
    console.log("cqp.s2", currentQueryParams.toString())

    // Construct the final URL using the updated query params
    const rssReaderUrl = `${baseUrl}?${currentQueryParams.toString()}`;

    // Output the URL (you can replace this with any other action)
    console.log(rssReaderUrl);

    // Optionally display the link in the page (e.g., append it to the body)
    const displayLink = document.getElementById('autoGeneratedReader');
    displayLink.href = rssReaderUrl;

    // Check if the current page URL contains '#feed'
    if (window.location.search.includes('#feed')) {
      // Automatically redirect to the RSS reader link
      window.location.href = rssReaderUrl;
    }
  });
</script>

